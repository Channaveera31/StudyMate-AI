<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Quiz - StudyMate AI</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
      }

      .header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 25px 35px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        animation: slideDown 0.6s ease-out;
      }

      .back-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 25px;
        color: white;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }

      .header h1 {
        color: white;
        font-size: 2rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .stats {
        display: flex;
        gap: 20px;
        align-items: center;
        color: white;
        font-weight: 600;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
      }

      .quiz-setup {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 24px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(20px);
        animation: slideUp 0.8s ease-out;
      }

      .quiz-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(20px);
        min-height: 500px;
        position: relative;
        overflow: hidden;
      }

      .setup-title {
        font-size: 1.8rem;
        color: #2d3748;
        margin-bottom: 30px;
        text-align: center;
        font-weight: 800;
      }

      .subject-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .subject-card {
        padding: 25px;
        border: 2px solid #e2e8f0;
        border-radius: 16px;
        background: #f8fafc;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .subject-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
      }

      .subject-card.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-3px);
      }

      .subject-card i {
        font-size: 2.5rem;
        margin-bottom: 15px;
        display: block;
      }

      .subject-card h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .difficulty-selector {
        margin: 30px 0;
        text-align: center;
      }

      .difficulty-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .difficulty-btn {
        padding: 12px 25px;
        border: 2px solid #e2e8f0;
        border-radius: 25px;
        background: white;
        color: #4a5568;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .difficulty-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }

      .difficulty-btn.selected {
        border-color: #48bb78;
        background: #48bb78;
        color: white;
      }

      .start-quiz-btn {
        display: block;
        width: 100%;
        max-width: 300px;
        margin: 30px auto 0;
        padding: 16px 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .start-quiz-btn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .start-quiz-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .quiz-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f1f5f9;
      }

      .question-counter {
        font-size: 1.2rem;
        font-weight: 700;
        color: #4a5568;
      }

      .timer {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.2rem;
        font-weight: 700;
        color: #e53e3e;
      }

      .timer.warning {
        animation: pulse 1s infinite;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 30px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        transition: width 0.5s ease;
        border-radius: 4px;
      }

      .question-card {
        background: #f8fafc;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        border: 1px solid #e2e8f0;
      }

      .question-text {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 25px;
        line-height: 1.6;
      }

      .options-container {
        display: grid;
        gap: 15px;
      }

      .option {
        padding: 18px 24px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .option:hover {
        border-color: #667eea;
        transform: translateX(5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .option.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .option.correct {
        border-color: #48bb78;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
      }

      .option.incorrect {
        border-color: #e53e3e;
        background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        color: white;
      }

      .option-letter {
        display: inline-block;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #e2e8f0;
        color: #4a5568;
        text-align: center;
        line-height: 32px;
        font-weight: 700;
        margin-right: 15px;
        transition: all 0.3s ease;
      }

      .option.selected .option-letter,
      .option.correct .option-letter,
      .option.incorrect .option-letter {
        background: rgba(255, 255, 255, 0.3);
        color: white;
      }

      .submit-btn {
        display: block;
        width: 200px;
        margin: 30px auto;
        padding: 14px 28px;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .submit-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
      }

      .submit-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .results-card {
        text-align: center;
        padding: 40px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 20px;
        margin-top: 30px;
      }

      .score-display {
        font-size: 4rem;
        font-weight: 900;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .score-text {
        font-size: 1.5rem;
        color: #4a5568;
        margin-bottom: 30px;
      }

      .performance-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 800;
        color: #2d3748;
      }

      .stat-label {
        color: #718096;
        font-weight: 600;
        margin-top: 5px;
      }

      .retry-btn {
        padding: 16px 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 0 10px;
      }

      .retry-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .floating-particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #667eea;
        border-radius: 50%;
        opacity: 0.6;
        animation: float 6s infinite ease-in-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
          padding: 20px;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .stats {
          flex-wrap: wrap;
          justify-content: center;
        }

        .quiz-setup,
        .quiz-container {
          padding: 25px;
        }

        .subject-grid {
          grid-template-columns: 1fr;
        }

        .difficulty-buttons {
          flex-direction: column;
          align-items: center;
        }

        .score-display {
          font-size: 3rem;
        }
      }

      .difficulty-card {
        padding: 25px;
        border: 2px solid #e2e8f0;
        border-radius: 16px;
        background: #f8fafc;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        text-align: center;
      }
      .difficulty-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <a href="dashboard.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back
        </a>
        <h1>
          <i class="fas fa-brain"></i>
          Interactive Quiz
        </h1>
        <div class="stats">
          <div class="stat-item">
            <i class="fas fa-trophy"></i>
            <span id="totalScore">0</span>
          </div>
          <div class="stat-item">
            <i class="fas fa-chart-line"></i>
            <span id="streak">0</span>
          </div>
        </div>
      </div>

      <div id="quizSetup" class="quiz-setup">
        <h2 class="setup-title">🎯 Choose Your Challenge</h2>

        <div class="subject-grid">
          <div class="subject-card" data-subject="math">
            <i class="fas fa-calculator"></i>
            <h3>Mathematics</h3>
            <p>Algebra, Geometry, Calculus</p>
          </div>
          <div class="subject-card" data-subject="science">
            <i class="fas fa-atom"></i>
            <h3>Science</h3>
            <p>Physics, Chemistry, Biology</p>
          </div>
          <div class="subject-card" data-subject="history">
            <i class="fas fa-landmark"></i>
            <h3>History</h3>
            <p>World History, Events</p>
          </div>
          <div class="subject-card" data-subject="literature">
            <i class="fas fa-book"></i>
            <h3>Literature</h3>
            <p>Classics, Analysis, Poetry</p>
          </div>
        </div>
        <!-- NEW: Upload File as subject card -->
        <div
          class="subject-card"
          onclick="document.getElementById('fileUpload').click();"
        >
          <i class="fas fa-upload"></i>
          <h3>Upload File</h3>
          <p>Generate quiz from your notes</p>
          <input
            type="file"
            id="fileUpload"
            accept=".txt,.pdf,.docx"
            style="display: none"
            onchange="handleFileQuiz()"
          />
        </div>
        <button class="start-quiz-btn" onclick="handleFileQuiz()">
          <i class="fas fa-magic"></i> Generate Quiz from File
        </button>
      </div>

      <div class="difficulty-card">
        <div class="difficulty-selector">
          <h3 style="margin-bottom: 15px; color: #4a5568">
            Select Difficulty:
          </h3>
          <div class="difficulty-buttons">
            <button class="difficulty-btn" data-difficulty="easy">
              <i class="fas fa-seedling"></i> Easy
            </button>
            <button class="difficulty-btn" data-difficulty="medium">
              <i class="fas fa-fire"></i> Medium
            </button>
            <button class="difficulty-btn" data-difficulty="hard">
              <i class="fas fa-bolt"></i> Hard
            </button>
          </div>
        </div>
        <button id="startQuizBtn" class="start-quiz-btn" disabled>
          <i class="fas fa-play"></i>
          Start Quiz Adventure!
        </button>
      </div>
      <!-- end of difficulty-card -->

      <div id="quizContainer" class="quiz-container" style="display: none">
        <div class="floating-particles"></div>

        <div class="quiz-header">
          <div class="question-counter">
            Question <span id="currentQuestion">1</span> of
            <span id="totalQuestions">10</span>
          </div>
          <div class="timer">
            <i class="fas fa-clock"></i>
            <span id="timeLeft">30</span>s
          </div>
        </div>

        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="question-card">
          <div class="question-text" id="questionText">
            Loading your question...
          </div>
          <div class="options-container" id="optionsContainer">
            <!-- Options will be populated by JavaScript -->
          </div>
        </div>

        <button id="submitBtn" class="submit-btn" disabled>
          <i class="fas fa-check"></i>
          Submit Answer
        </button>
      </div>
      <!-- end of difficulty-card -->

      <div id="resultsContainer" class="results-card" style="display: none">
        <div class="score-display" id="finalScore">0%</div>
        <div class="score-text" id="scoreText">Great job!</div>

        <div class="performance-stats">
          <div class="stat-card">
            <div class="stat-number" id="correctAnswers">0</div>
            <div class="stat-label">Correct</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalTime">0s</div>
            <div class="stat-label">Total Time</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avgTime">0s</div>
            <div class="stat-label">Avg Time</div>
          </div>
        </div>

        <div>
          <button class="retry-btn" onclick="resetQuiz()">
            <i class="fas fa-redo"></i>
            Try Again
          </button>
          <button class="retry-btn" onclick="window.location.href='index.html'">
            <i class="fas fa-home"></i>
            Home
          </button>
        </div>
      </div>
    </div>

    <script>
      // Quiz state
      let currentQuizData = [];
      let currentQuestionIndex = 0;
      let selectedSubject = "";
      let selectedDifficulty = "";
      let score = 0;
      let timeLeft = 30;
      let timer = null;
      let startTime = null;
      let questionTimes = [];
      let totalScore = parseInt(localStorage.getItem("totalScore") || "0");
      let streak = parseInt(localStorage.getItem("streak") || "0");

      // DOM elements
      const quizSetup = document.getElementById("quizSetup");
      const quizContainer = document.getElementById("quizContainer");
      const resultsContainer = document.getElementById("resultsContainer");
      const subjectCards = document.querySelectorAll(".subject-card");
      const difficultyBtns = document.querySelectorAll(".difficulty-btn");
      const startQuizBtn = document.getElementById("startQuizBtn");

      // Quiz questions database
      const quizDatabase = {
        math: {
          easy: [
            {
              question: "What is 15 + 27?",
              options: ["42", "41", "43", "40"],
              correct: 0,
            },
            {
              question:
                "What is the area of a rectangle with length 8 and width 5?",
              options: ["40", "35", "45", "30"],
              correct: 0,
            },
            {
              question: "What is 12 × 6?",
              options: ["72", "68", "76", "70"],
              correct: 0,
            },
          ],
          medium: [
            {
              question: "Solve: 2x + 8 = 20",
              options: ["x = 6", "x = 4", "x = 8", "x = 2"],
              correct: 0,
            },
            {
              question: "What is the derivative of x²?",
              options: ["2x", "x", "x²", "2x²"],
              correct: 0,
            },
          ],
          hard: [
            {
              question: "Find the limit: lim(x→0) (sin x)/x",
              options: ["1", "0", "∞", "undefined"],
              correct: 0,
            },
          ],
        },
        science: {
          easy: [
            {
              question: "What is the chemical symbol for water?",
              options: ["H₂O", "CO₂", "NaCl", "O₂"],
              correct: 0,
            },
            {
              question: "How many planets are in our solar system?",
              options: ["8", "7", "9", "10"],
              correct: 0,
            },
            {
              question: "What gas do plants absorb from the atmosphere?",
              options: ["Carbon dioxide", "Oxygen", "Nitrogen", "Hydrogen"],
              correct: 0,
            },
          ],
          medium: [
            {
              question: "What is Newton's second law of motion?",
              options: ["F = ma", "E = mc²", "PV = nRT", "F = kx"],
              correct: 0,
            },
          ],
          hard: [
            {
              question: "What is the Heisenberg Uncertainty Principle?",
              options: [
                "Position and momentum cannot be precisely known simultaneously",
                "Energy equals mass times speed of light squared",
                "Force equals mass times acceleration",
                "Every action has an equal and opposite reaction",
              ],
              correct: 0,
            },
          ],
        },
        history: {
          easy: [
            {
              question: "In which year did World War II end?",
              options: ["1945", "1944", "1946", "1943"],
              correct: 0,
            },
            {
              question: "Who was the first President of the United States?",
              options: [
                "George Washington",
                "Thomas Jefferson",
                "John Adams",
                "Benjamin Franklin",
              ],
              correct: 0,
            },
          ],
          medium: [
            {
              question: "The Renaissance began in which country?",
              options: ["Italy", "France", "Germany", "England"],
              correct: 0,
            },
          ],
          hard: [
            {
              question: "What treaty ended the Thirty Years' War?",
              options: [
                "Peace of Westphalia",
                "Treaty of Versailles",
                "Treaty of Paris",
                "Congress of Vienna",
              ],
              correct: 0,
            },
          ],
        },
        literature: {
          easy: [
            {
              question: "Who wrote 'Romeo and Juliet'?",
              options: [
                "William Shakespeare",
                "Charles Dickens",
                "Jane Austen",
                "Mark Twain",
              ],
              correct: 0,
            },
          ],
          medium: [
            {
              question:
                "In which novel would you find the character Jay Gatsby?",
              options: [
                "The Great Gatsby",
                "To Kill a Mockingbird",
                "1984",
                "Pride and Prejudice",
              ],
              correct: 0,
            },
          ],
          hard: [
            {
              question: "Who wrote 'One Hundred Years of Solitude'?",
              options: [
                "Gabriel García Márquez",
                "Jorge Luis Borges",
                "Pablo Neruda",
                "Octavio Paz",
              ],
              correct: 0,
            },
          ],
        },
      };

      // Initialize
      updateStats();
      createFloatingParticles();

      // Event listeners
      subjectCards.forEach((card) => {
        card.addEventListener("click", () => {
          subjectCards.forEach((c) => c.classList.remove("selected"));
          card.classList.add("selected");
          selectedSubject = card.dataset.subject;
          checkStartButton();
        });
      });

      difficultyBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          difficultyBtns.forEach((b) => b.classList.remove("selected"));
          btn.classList.add("selected");
          selectedDifficulty = btn.dataset.difficulty;
          checkStartButton();
        });
      });

      startQuizBtn.addEventListener("click", startQuiz);

      function checkStartButton() {
        startQuizBtn.disabled = !selectedSubject || !selectedDifficulty;
      }

      function startQuiz() {
        // Get questions for selected subject and difficulty
        let questions = quizDatabase[selectedSubject][selectedDifficulty];

        // Add more questions by mixing from other difficulties if needed
        if (questions.length < 10) {
          const allDifficulties = ["easy", "medium", "hard"];
          allDifficulties.forEach((diff) => {
            if (diff !== selectedDifficulty && questions.length < 10) {
              questions = [
                ...questions,
                ...quizDatabase[selectedSubject][diff],
              ];
            }
          });
        }

        // Shuffle and limit to 10 questions
        currentQuizData = shuffleArray(questions).slice(0, 10);

        // Reset quiz state
        currentQuestionIndex = 0;
        score = 0;
        questionTimes = [];
        startTime = Date.now();

        // Show quiz container
        quizSetup.style.display = "none";
        quizContainer.style.display = "block";

        document.getElementById("totalQuestions").textContent =
          currentQuizData.length;

        displayQuestion();
      }

      function displayQuestion() {
        const question = currentQuizData[currentQuestionIndex];

        document.getElementById("currentQuestion").textContent =
          currentQuestionIndex + 1;
        document.getElementById("questionText").textContent = question.question;

        const optionsContainer = document.getElementById("optionsContainer");
        optionsContainer.innerHTML = "";

        question.options.forEach((option, index) => {
          const optionElement = document.createElement("div");
          optionElement.className = "option";
          optionElement.innerHTML = `
                    <span class="option-letter">${String.fromCharCode(
                      65 + index
                    )}</span>
                    ${option}
                `;
          optionElement.addEventListener("click", () => selectOption(index));
          optionsContainer.appendChild(optionElement);
        });

        // Update progress
        const progress =
          ((currentQuestionIndex + 1) / currentQuizData.length) * 100;
        document.getElementById("progressFill").style.width = `${progress}%`;

        // Start timer
        startTimer();

        // Reset submit button
        document.getElementById("submitBtn").disabled = true;
        document.getElementById("submitBtn").onclick = submitAnswer;
      }

      function selectOption(index) {
        const options = document.querySelectorAll(".option");
        options.forEach((option) => option.classList.remove("selected"));
        options[index].classList.add("selected");

        document.getElementById("submitBtn").disabled = false;
        selectedOptionIndex = index;
      }

      function submitAnswer() {
        const question = currentQuizData[currentQuestionIndex];
        const options = document.querySelectorAll(".option");

        // Stop timer
        clearInterval(timer);
        const questionTime = 30 - timeLeft;
        questionTimes.push(questionTime);

        // Show correct/incorrect
        options.forEach((option, index) => {
          if (index === question.correct) {
            option.classList.add("correct");
          } else if (index === selectedOptionIndex) {
            option.classList.add("incorrect");
          }
          option.style.pointerEvents = "none";
        });

        // Check if answer is correct
        if (selectedOptionIndex === question.correct) {
          score++;
          showFeedback("Correct! 🎉", true);
        } else {
          showFeedback("Incorrect! 😅", false);
        }

        // Update submit button
        document.getElementById("submitBtn").textContent = "Next Question";
        document.getElementById("submitBtn").onclick = nextQuestion;
      }

      function nextQuestion() {
        currentQuestionIndex++;

        if (currentQuestionIndex < currentQuizData.length) {
          displayQuestion();
        } else {
          showResults();
        }
      }

      function showResults() {
        const percentage = Math.round((score / currentQuizData.length) * 100);
        const totalTime = questionTimes.reduce((a, b) => a + b, 0);
        const avgTime = Math.round(totalTime / currentQuizData.length);

        // Update total score and streak
        totalScore += score;
        if (percentage >= 70) {
          streak++;
        } else {
          streak = 0;
        }

        localStorage.setItem("totalScore", totalScore.toString());
        localStorage.setItem("streak", streak.toString());
        updateStats();

        // Show results
        quizContainer.style.display = "none";
        resultsContainer.style.display = "block";

        document.getElementById("finalScore").textContent = `${percentage}%`;
        document.getElementById("correctAnswers").textContent = score;
        document.getElementById("totalTime").textContent = `${totalTime}s`;
        document.getElementById("avgTime").textContent = `${avgTime}s`;

        // Score message
        let message = "";
        if (percentage >= 90) message = "Outstanding! 🏆";
        else if (percentage >= 80) message = "Excellent work! 🌟";
        else if (percentage >= 70) message = "Good job! 👍";
        else if (percentage >= 60) message = "Not bad! 📚";
        else message = "Keep practicing! 💪";

        document.getElementById("scoreText").textContent = message;
      }

      function resetQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        selectedSubject = "";
        selectedDifficulty = "";

        // Reset UI
        subjectCards.forEach((card) => card.classList.remove("selected"));
        difficultyBtns.forEach((btn) => btn.classList.remove("selected"));

        quizContainer.style.display = "none";
        resultsContainer.style.display = "none";
        quizSetup.style.display = "block";

        startQuizBtn.disabled = true;
        startQuizBtn.innerHTML =
          '<i class="fas fa-play"></i> Start Quiz Adventure!';
      }

      async function extractText(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.onerror = (e) => reject(e);
          reader.readAsText(file);
        });
      }

      async function generateQuizFromFile(file) {
        const text = await extractText(file);

        const response = await fetch(
          "https://api.groq.com/openai/v1/chat/completions",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer YOUR_GROQ_API_KEY", // 🔑 Replace with your GroqCloud API key
            },
            body: JSON.stringify({
              model: "mixtral-8x7b-32768",
              messages: [
                { role: "system", content: "You are a quiz generator AI." },
                {
                  role: "user",
                  content: `Generate 10 multiple-choice quiz questions with 4 options each and specify the correct answer based on this text:\n\n${text}\n\nFormat:\nQuestion?\nA) ...\nB) ...\nC) ...\nD) ...\nAnswer: X`,
                },
              ],
            }),
          }
        );

        const data = await response.json();
        const aiOutput = data.choices[0].message.content;
        return parseQuestionsFromText(aiOutput);
      }

      function parseQuestionsFromText(aiOutput) {
        const questions = [];
        const blocks = aiOutput.trim().split(/\n\n+/);

        blocks.forEach((block) => {
          const lines = block
            .split("\n")
            .map((l) => l.trim())
            .filter(Boolean);
          if (lines.length < 6) return;
          const question = lines[0];
          const options = lines
            .slice(1, 5)
            .map((l) => l.replace(/^[A-D]\)\s*/, ""));
          const answerLine = lines.find((l) => l.startsWith("Answer"));
          const correctLetter = answerLine
            ? answerLine.split(":")[1].trim()
            : "A";
          const correctIndex = "ABCD".indexOf(correctLetter);

          questions.push({
            question,
            options,
            correct: correctIndex >= 0 ? correctIndex : 0,
          });
        });
        return questions;
      }

      async function handleFileQuiz() {
        const file = document.getElementById("fileUpload").files[0];
        if (!file) {
          alert("Please upload a file first!");
          return;
        }
        startQuizBtn.disabled = true;
        startQuizBtn.innerHTML = "⏳ Generating AI Quiz...";
        try {
          const questions = await generateQuizFromFile(file);
          if (!questions.length) {
            alert("AI could not generate quiz from file.");
            startQuizBtn.innerHTML = "Start Quiz Adventure!";
            return;
          }
          // overwrite quiz data with AI-generated
          currentQuizData = questions;
          selectedSubject = "ai";
          selectedDifficulty = "custom";

          currentQuestionIndex = 0;
          score = 0;
          questionTimes = [];
          startTime = Date.now();

          quizSetup.style.display = "none";
          quizContainer.style.display = "block";
          document.getElementById("totalQuestions").textContent =
            currentQuizData.length;
          displayQuestion();
        } catch (err) {
          console.error(err);
          alert("Error generating quiz from file.");
        } finally {
          startQuizBtn.innerHTML =
            '<i class="fas fa-play"></i> Start Quiz Adventure!';
        }
      }

      function startTimer() {
        timeLeft = 30;
        document.getElementById("timeLeft").textContent = timeLeft;

        timer = setInterval(() => {
          timeLeft--;
          document.getElementById("timeLeft").textContent = timeLeft;

          const timerElement = document.querySelector(".timer");
          if (timeLeft <= 10) {
            timerElement.classList.add("warning");
          } else {
            timerElement.classList.remove("warning");
          }

          if (timeLeft <= 0) {
            clearInterval(timer);
            // Auto-submit if time runs out
            if (typeof selectedOptionIndex !== "undefined") {
              submitAnswer();
            } else {
              // No answer selected, mark as incorrect
              selectedOptionIndex = -1;
              submitAnswer();
            }
          }
        }, 1000);
      }

      function showFeedback(message, isCorrect) {
        // Create feedback popup
        const feedback = document.createElement("div");
        feedback.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${isCorrect ? "#48bb78" : "#e53e3e"};
                color: white;
                padding: 20px 40px;
                border-radius: 25px;
                font-size: 1.5rem;
                font-weight: bold;
                z-index: 1000;
                animation: feedbackPop 2s ease-out forwards;
            `;
        feedback.textContent = message;
        document.body.appendChild(feedback);

        setTimeout(() => feedback.remove(), 2000);
      }

      function updateStats() {
        document.getElementById("totalScore").textContent = totalScore;
        document.getElementById("streak").textContent = streak;
      }

      function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      }

      function createFloatingParticles() {
        const particlesContainer = document.querySelector(
          ".floating-particles"
        );

        for (let i = 0; i < 20; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 6 + "s";
          particle.style.animationDuration = 3 + Math.random() * 6 + "s";
          particlesContainer.appendChild(particle);
        }
      }

      // Add CSS for feedback animation
      const style = document.createElement("style");
      style.textContent = `
            @keyframes feedbackPop {
                0% {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.5);
                }
                20% {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1.1);
                }
                100% {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
        `;
      document.head.appendChild(style);

      // Real-time features
      setInterval(() => {
        // Add subtle animations to cards
        const cards = document.querySelectorAll(".subject-card:not(.selected)");
        if (cards.length > 0) {
          const randomCard = cards[Math.floor(Math.random() * cards.length)];
          randomCard.style.transform = "translateY(-2px)";
          setTimeout(() => {
            randomCard.style.transform = "translateY(0)";
          }, 1000);
        }
      }, 3000);

      // Initialize variables
      let selectedOptionIndex = -1;
    </script>
  </body>
</html>
