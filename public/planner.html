<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Study Planner - StudyMate AI</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated background particles */
      .particles {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }

      .particle {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
        min-height: 100vh;
      }

      /* Header with glassmorphism */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 24px 32px;
        margin-bottom: 32px;
        animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 28px;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        color: white;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        backdrop-filter: blur(10px);
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
      }

      .header h1 {
        color: white;
        font-size: 2.2rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 16px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .header-icon {
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      /* Status indicator */
      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(72, 187, 120, 0.2);
        border: 1px solid rgba(72, 187, 120, 0.3);
        color: #48bb78;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        background: #48bb78;
        border-radius: 50%;
        animation: blink 2s ease-in-out infinite;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      /* Main content grid */
      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        min-height: calc(100vh - 200px);
      }

      .section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        animation: slideUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 24px 24px 0 0;
      }

      .section-title {
        font-size: 1.6rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 28px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .form-group {
        margin-bottom: 24px;
        position: relative;
      }

      .form-label {
        display: block;
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .form-control {
        width: 100%;
        padding: 18px 24px;
        border: 2px solid #e2e8f0;
        border-radius: 16px;
        font-size: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
        font-family: inherit;
      }

      .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
        transform: translateY(-2px);
      }

      .form-control:valid {
        border-color: #48bb78;
      }

      .generate-btn {
        width: 100%;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        position: relative;
        overflow: hidden;
      }

      .generate-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.6s;
      }

      .generate-btn:hover::before {
        left: 100%;
      }

      .generate-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
      }

      .generate-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .plan-output {
        background: #f8fafc;
        border-radius: 20px;
        padding: 28px;
        min-height: 350px;
        border: 2px dashed #cbd5e0;
        color: #718096;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 1.1rem;
        overflow-y: auto;
        max-height: 450px;
        transition: all 0.3s ease;
        position: relative;
      }

      .plan-output:hover {
        border-color: #667eea;
        background: #f1f5f9;
      }

      .plan-content {
        color: #2d3748;
        text-align: left;
        width: 100%;
      }

      .plan-item {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 16px;
        border-left: 4px solid #667eea;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .plan-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        transform: scaleX(0);
        transition: transform 0.3s ease;
      }

      .plan-item:hover {
        transform: translateX(8px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      }

      .plan-item:hover::before {
        transform: scaleX(1);
      }

      .plan-day {
        font-weight: 700;
        color: #667eea;
        margin-bottom: 12px;
        font-size: 1.1rem;
      }

      .plan-tasks {
        color: #4a5568;
        line-height: 1.6;
      }

      .download-btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 24px;
        display: none;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(72, 187, 120, 0.3);
      }

      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
        color: #667eea;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #e2e8f0;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .progress-bar {
        width: 200px;
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.5s ease;
        border-radius: 3px;
      }

      .loading-text {
        font-weight: 600;
        font-size: 1.1rem;
        text-align: center;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes slideDown {
        0% {
          opacity: 0;
          transform: translateY(-50px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideUp {
        0% {
          opacity: 0;
          transform: translateY(50px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Real-time typing indicator */
      .typing-indicator {
        display: none;
        align-items: center;
        gap: 8px;
        color: #667eea;
        font-size: 0.9rem;
        margin-top: 8px;
      }

      .typing-dot {
        width: 4px;
        height: 4px;
        background: #667eea;
        border-radius: 50%;
        animation: typingDots 1.4s ease-in-out infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingDots {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-10px);
        }
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 24px;
        }

        .header {
          flex-direction: column;
          gap: 16px;
          text-align: center;
          padding: 20px;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .container {
          padding: 16px;
        }

        .section {
          padding: 24px;
        }

        .particles {
          display: none;
        }
      }

      /* Custom scrollbar */
      .plan-output::-webkit-scrollbar {
        width: 6px;
      }

      .plan-output::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .plan-output::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 10px;
      }

      .plan-output::-webkit-scrollbar-thumb:hover {
        background: #5a6fd8;
      }
    </style>
  </head>
  <body>
    <!-- Animated background particles -->
    <div class="particles" id="particles"></div>

    <div class="container">
      <header class="header">
        <a href="dashboard.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Back
        </a>
        <h1>
          <i class="fas fa-brain header-icon"></i>
          AI Study Planner
        </h1>
        <div class="status-indicator">
          <div class="status-dot"></div>
          Real-time Active
        </div>
      </header>

      <div class="main-content">
        <div class="section">
          <h2 class="section-title">
            <i class="fas fa-edit"></i>
            Create Your Study Plan
          </h2>

          <div class="form-group">
            <label for="subjectInput" class="form-label">
              <i class="fas fa-book"></i>
              Subject/Course
            </label>
            <input
              type="text"
              id="subjectInput"
              class="form-control"
              placeholder="e.g., Advanced Mathematics, Physics, Chemistry"
              required
            />
            <div class="typing-indicator" id="subjectTyping">
              AI analyzing subject...
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>

          <div class="form-group">
            <label for="examDateInput" class="form-label">
              <i class="fas fa-calendar-alt"></i>
              Exam Date
            </label>
            <input
              type="date"
              id="examDateInput"
              class="form-control"
              required
            />
          </div>

          <div class="form-group">
            <label for="studyHoursInput" class="form-label">
              <i class="fas fa-clock"></i>
              Daily Study Hours
            </label>
            <input
              type="number"
              id="studyHoursInput"
              class="form-control"
              min="1"
              max="12"
              placeholder="How many hours per day?"
              required
            />
          </div>

          <button id="generatePlanBtn" class="generate-btn">
            <i class="fas fa-magic"></i>
            Generate AI Study Plan
          </button>
        </div>

        <div class="section">
          <h2 class="section-title">
            <i class="fas fa-chart-line"></i>
            Your Personalized Plan
          </h2>

          <div id="planOutput" class="plan-output">
            <div>
              <i
                class="fas fa-lightbulb"
                style="
                  font-size: 3rem;
                  color: #cbd5e0;
                  margin-bottom: 20px;
                  animation: pulse 2s ease-in-out infinite;
                "
              ></i>
              <p style="font-weight: 600; margin-bottom: 12px">
                Your AI-generated study plan will appear here...
              </p>
              <p style="font-size: 0.9rem; opacity: 0.8">
                Fill in the details and click "Generate AI Study Plan"
              </p>
            </div>
          </div>

          <button id="downloadPDFBtn" class="download-btn">
            <i class="fas fa-download"></i>
            Download Plan as PDF
          </button>
        </div>
      </div>
    </div>

    <script>
      // Create animated background particles
      function createParticles() {
        const particles = document.getElementById("particles");
        for (let i = 0; i < 20; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.width = Math.random() * 10 + 5 + "px";
          particle.style.height = particle.style.width;
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 6 + "s";
          particle.style.animationDuration = Math.random() * 4 + 4 + "s";
          particles.appendChild(particle);
        }
      }

      // DOM elements
      const subjectInput = document.getElementById("subjectInput");
      const examDateInput = document.getElementById("examDateInput");
      const studyHoursInput = document.getElementById("studyHoursInput");
      const generateBtn = document.getElementById("generatePlanBtn");
      const planOutput = document.getElementById("planOutput");
      const downloadBtn = document.getElementById("downloadPDFBtn");
      const subjectTyping = document.getElementById("subjectTyping");

      // Set minimum date to today
      const today = new Date().toISOString().split("T")[0];
      examDateInput.min = today;

      // Real-time form validation
      function validateForm() {
        const isValid =
          subjectInput.value.trim() &&
          examDateInput.value &&
          studyHoursInput.value &&
          parseInt(studyHoursInput.value) > 0;

        generateBtn.style.opacity = isValid ? "1" : "0.6";
        generateBtn.style.cursor = isValid ? "pointer" : "not-allowed";
        generateBtn.disabled = !isValid;

        return isValid;
      }

      // Real-time typing feedback
      let typingTimer;
      subjectInput.addEventListener("input", () => {
        clearTimeout(typingTimer);
        if (subjectInput.value.length > 2) {
          subjectTyping.style.display = "flex";
          typingTimer = setTimeout(() => {
            subjectTyping.style.display = "none";
          }, 2000);
        } else {
          subjectTyping.style.display = "none";
        }
        validateForm();
      });

      // Add real-time feedback for other inputs
      [examDateInput, studyHoursInput].forEach((input) => {
        input.addEventListener("input", validateForm);
        input.addEventListener("change", validateForm);
      });

      // Enhanced study plan generation
      generateBtn.addEventListener("click", async () => {
        if (!validateForm()) return;

        const subject = subjectInput.value.trim();
        const examDate = new Date(examDateInput.value);
        const dailyHours = parseInt(studyHoursInput.value);
        const today = new Date();
        const daysUntilExam = Math.ceil(
          (examDate - today) / (1000 * 60 * 60 * 24)
        );

        if (daysUntilExam <= 0) {
          showNotification(
            "Please select a future date for your exam.",
            "error"
          );
          return;
        }

        // Enhanced loading state with progress
        showLoadingWithProgress();

        // Simulate AI processing with realistic delay
        await new Promise((resolve) => setTimeout(resolve, 3000));

        // Generate enhanced study plan
        const plan = generateEnhancedStudyPlan(
          subject,
          daysUntilExam,
          dailyHours
        );
        displayEnhancedPlan(plan);
        downloadBtn.style.display = "flex";

        showNotification("Study plan generated successfully!", "success");
      });

      function showLoadingWithProgress() {
        const loadingSteps = [
          { progress: 0, text: "Initializing AI..." },
          { progress: 20, text: "Analyzing subject complexity..." },
          { progress: 40, text: "Calculating optimal timeline..." },
          { progress: 60, text: "Personalizing study methods..." },
          { progress: 80, text: "Optimizing schedule..." },
          { progress: 100, text: "Finalizing plan..." },
        ];

        let currentStep = 0;

        const updateLoading = () => {
          const step = loadingSteps[currentStep];
          planOutput.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${step.progress}%"></div>
                        </div>
                        <div class="loading-text">${step.text}</div>
                    </div>
                `;

          currentStep++;
          if (currentStep < loadingSteps.length) {
            setTimeout(updateLoading, 500);
          }
        };

        updateLoading();
      }

      function generateEnhancedStudyPlan(subject, days, hoursPerDay) {
        const topics = getTopicsForSubject(subject);
        const totalHours = days * hoursPerDay;
        const plan = [];

        const studyPhases = {
          foundation: Math.min(Math.ceil(days * 0.3), 7),
          intensive: Math.ceil(days * 0.5),
          revision: Math.max(Math.ceil(days * 0.2), 3),
        };

        for (let day = 1; day <= Math.min(days, 30); day++) {
          const dayPlan = {
            day: day,
            date: new Date(
              Date.now() + (day - 1) * 24 * 60 * 60 * 1000
            ).toLocaleDateString(),
            phase:
              day <= studyPhases.foundation
                ? "Foundation"
                : day <= studyPhases.foundation + studyPhases.intensive
                ? "Intensive Study"
                : "Revision",
            tasks: [],
            totalHours: hoursPerDay,
          };

          if (day <= studyPhases.foundation) {
            dayPlan.tasks = [
              `ðŸ“š Review ${subject} fundamentals (${Math.floor(
                hoursPerDay * 0.4
              )}h)`,
              `ðŸ“ Create comprehensive notes (${Math.floor(
                hoursPerDay * 0.3
              )}h)`,
              `ðŸ§  Practice basic concepts (${Math.ceil(hoursPerDay * 0.3)}h)`,
            ];
          } else if (day <= studyPhases.foundation + studyPhases.intensive) {
            const topicIndex =
              (day - studyPhases.foundation - 1) % topics.length;
            dayPlan.tasks = [
              `ðŸ“– Deep dive: ${topics[topicIndex]} (${Math.floor(
                hoursPerDay * 0.5
              )}h)`,
              `âœï¸ Advanced problem solving (${Math.floor(hoursPerDay * 0.3)}h)`,
              `ðŸ”„ Review previous topics (${Math.ceil(hoursPerDay * 0.2)}h)`,
            ];
          } else {
            dayPlan.tasks = [
              `ðŸ”„ Comprehensive review (${Math.floor(hoursPerDay * 0.4)}h)`,
              `ðŸ“‹ Practice exams (${Math.floor(hoursPerDay * 0.4)}h)`,
              `ðŸŽ¯ Focus on weak areas (${Math.ceil(hoursPerDay * 0.2)}h)`,
            ];
          }

          plan.push(dayPlan);
        }

        return plan;
      }

      function displayEnhancedPlan(plan) {
        const planHtml = plan
          .map(
            (dayPlan, index) => `
                <div class="plan-item" style="animation-delay: ${index * 0.1}s">
                    <div class="plan-day">
                        Day ${dayPlan.day} - ${dayPlan.date}
                        <span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; margin-left: 12px;">
                            ${dayPlan.phase}
                        </span>
                    </div>
                    <div class="plan-tasks">
                        ${dayPlan.tasks
                          .map(
                            (task) => `
                            <div style="margin-bottom: 8px; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                â€¢ ${task}
                            </div>
                        `
                          )
                          .join("")}
                        <div style="margin-top: 12px; font-weight: 600; color: #667eea;">
                            Total: ${dayPlan.totalHours} hours
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        planOutput.innerHTML = `<div class="plan-content">${planHtml}</div>`;
        planOutput.scrollTop = 0;
      }

      function getTopicsForSubject(subject) {
        const topicMap = {
          math: [
            "Algebra",
            "Geometry",
            "Calculus",
            "Statistics",
            "Trigonometry",
          ],
          physics: [
            "Mechanics",
            "Thermodynamics",
            "Electromagnetism",
            "Optics",
            "Quantum Physics",
          ],
          chemistry: [
            "Atomic Structure",
            "Chemical Bonding",
            "Organic Chemistry",
            "Physical Chemistry",
            "Inorganic Chemistry",
          ],
          biology: [
            "Cell Biology",
            "Genetics",
            "Evolution",
            "Ecology",
            "Physiology",
          ],
          history: [
            "Ancient History",
            "Medieval Period",
            "Modern History",
            "World Wars",
            "Contemporary Issues",
          ],
          english: [
            "Grammar",
            "Literature Analysis",
            "Essay Writing",
            "Poetry",
            "Reading Comprehension",
          ],
        };

        const subjectLower = subject.toLowerCase();
        for (const [key, topics] of Object.entries(topicMap)) {
          if (subjectLower.includes(key)) {
            return topics;
          }
        }

        return [
          "Core Concepts",
          "Advanced Topics",
          "Practice Problems",
          "Case Studies",
          "Review Materials",
        ];
      }

      // Enhanced PDF download
      downloadBtn.addEventListener("click", () => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();

        // Add header
        pdf.setFontSize(24);
        pdf.setTextColor(102, 126, 234);
        pdf.text("AI Study Plan", 20, 30);

        // Add line
        pdf.setDrawColor(102, 126, 234);
        pdf.setLineWidth(2);
        pdf.line(20, 35, 190, 35);

        // Add details
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Subject: ${subjectInput.value}`, 20, 50);
        pdf.text(`Exam Date: ${examDateInput.value}`, 20, 60);
        pdf.text(`Daily Hours: ${studyHoursInput.value}`, 20, 70);
        pdf.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 80);

        let yPosition = 100;
        const planItems = document.querySelectorAll(".plan-item");

        planItems.forEach((item, index) => {
          if (yPosition > 270) {
            pdf.addPage();
            yPosition = 20;
          }

          const dayText = item
            .querySelector(".plan-day")
            .textContent.split("\n")[0];
          const tasksText = item.querySelector(".plan-tasks").textContent;

          pdf.setFontSize(14);
          pdf.setTextColor(102, 126, 234);
          pdf.text(dayText, 20, yPosition);
          yPosition += 10;

          pdf.setFontSize(10);
          pdf.setTextColor(0, 0, 0);
          const tasks = tasksText
            .split("â€¢")
            .filter((task) => task.trim() && !task.includes("Total:"));
          tasks.forEach((task) => {
            const wrappedText = pdf.splitTextToSize(`â€¢ ${task.trim()}`, 170);
            pdf.text(wrappedText, 25, yPosition);
            yPosition += wrappedText.length * 5;
          });

          yPosition += 10;
        });

        pdf.save(`${subjectInput.value.replace(/\s+/g, "_")}_study_plan.pdf`);
        showNotification("PDF downloaded successfully!", "success");
      });

      // Notification system
      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: ${
                  type === "success"
                    ? "#48bb78"
                    : type === "error"
                    ? "#f56565"
                    : "#667eea"
                };
                color: white;
                border-radius: 12px;
                z-index: 1000;
                font-weight: 600;
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.transform = "translateX(0)";
        }, 100);

        setTimeout(() => {
          notification.style.transform = "translateX(400px)";
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      // Real-time updates
      function updateRealTimeFeatures() {
        // Update particles
        const particles = document.querySelectorAll(".particle");
        particles.forEach((particle) => {
          if (Math.random() > 0.98) {
            particle.style.opacity = Math.random();
          }
        });

        // Update status indicator
        const statusDot = document.querySelector(".status-dot");
        if (statusDot) {
          statusDot.style.background =
            Math.random() > 0.5 ? "#48bb78" : "#667eea";
        }
      }

      // Initialize everything
      function init() {
        createParticles();
        validateForm();

        // Real-time updates every 3 seconds
        setInterval(updateRealTimeFeatures, 3000);

        // Auto-save form data
        const formInputs = [subjectInput, examDateInput, studyHoursInput];
        formInputs.forEach((input) => {
          input.addEventListener("input", () => {
            sessionStorage.setItem(input.id, input.value);
          });

          // Restore saved data
          const savedValue = sessionStorage.getItem(input.id);
          if (savedValue) {
            input.value = savedValue;
          }
        });

        showNotification("AI Study Planner ready!", "success");
      }

      // Start everything when page loads
      document.addEventListener("DOMContentLoaded", init);

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.key === "Enter") {
          e.preventDefault();
          generateBtn.click();
        }
        if (
          e.ctrlKey &&
          e.key === "s" &&
          downloadBtn.style.display === "flex"
        ) {
          e.preventDefault();
          downloadBtn.click();
        }
      });
    </script>
  </body>
</html>
